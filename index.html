<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì‹ ì˜ì† v24.1 - 1ë²ˆì½”ë“œ (17ìˆ˜ í™•ì •)</title>
    <style>
        :root { --gold: #ffd700; --bg: #0b0b0b; --card: #1a1a1a; --accent: #00ffcc; --save: #ff00ff; }
        body { background-color: var(--bg); color: var(--gold); font-family: 'Malgun Gothic', sans-serif; padding: 10px; margin: 0; }
        .outer-border { border: 2px solid var(--gold); border-radius: 20px; padding: 15px; max-width: 480px; margin: 0 auto; }
        
        .header-box { text-align: center; margin-bottom: 10px; }
        .next-episode { font-size: 24px; font-weight: 900; color: #fff; text-shadow: 0 0 10px rgba(255,215,0,0.5); }
        
        .round-big {
            font-size: 48px;
            font-weight: 900;
            color: #ffd700;
            text-shadow: 0 0 20px #ffd700;
            line-height: 1.2;
            margin: 5px 0;
        }
        
        .status-info { 
            font-size: 11px; 
            color: var(--accent); 
            line-height: 1.5; 
            min-height: 80px;
            width: 100%; 
            background: rgba(255,255,255,0.05); 
            border-radius: 12px; 
            padding: 10px; 
            box-sizing: border-box; 
            margin: 10px 0; 
            text-align: left; 
            border: 1px solid #333; 
        }
        
        .highlight-gold { color: var(--gold); font-weight: bold; }
        .highlight-red { color: #ff4444; font-weight: bold; }
        .highlight-blue { color: #00ccff; font-weight: bold; }
        
        .selector-container { margin-bottom: 15px; }
        .selector-toggle { width: 100%; height: 40px; background: #222; border: 1px solid var(--gold); border-radius: 10px; color: var(--gold); font-weight: bold; cursor: pointer; margin-bottom: 5px; }
        
        #selectorPanel { display: none; background: #1a1a1a; border-radius: 10px; padding: 10px; border: 1px solid #333; }
        .selector-grid { display: grid; grid-template-columns: repeat(9, 1fr); gap: 8px; }
        
        .number-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }
        
        .sel-box {
            aspect-ratio: 1;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border-radius: 4px;
            background: #333;
            color: #888;
            cursor: pointer;
            border: 1px solid transparent;
        }
        
        .sel-box.active {
            background: var(--accent);
            color: #000;
            font-weight: bold;
        }
        
        .fix-btn {
            width: 100%;
            font-size: 10px;
            padding: 4px 0;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            background: #333;
            color: #aaa;
            transition: 0.2s;
        }
        
        .fix-btn.fixed {
            background: #ff00ff;
            color: white;
            font-weight: bold;
        }
        
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 15px 0; }
        button { border-radius: 10px; font-weight: bold; cursor: pointer; border: none; height: 45px; }
        .btn-main { background: linear-gradient(135deg, #ffd700, #b8860b); color: #000; font-size: 16px; }
        .btn-sub { background: #222; color: #fff; border: 1px solid #444; }
        .btn-reset { grid-column: span 2; background: #333; color: #aaa; height: 40px; }
        
        .row-line { background: var(--card); border-radius: 12px; padding: 10px; margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; border: 1px solid #333; }
        .num-container { display: flex; gap: 4px; flex-grow: 1; justify-content: center; flex-wrap: wrap; }
        .num-box { width: 32px; height: 32px; line-height: 32px; text-align: center; font-size: 14px; font-weight: 900; border-radius: 50%; color: #fff; }
        .fixed { background: linear-gradient(135deg, #00ffcc, #00a884); color: #000; } 
        .zero { background: linear-gradient(135deg, #ff4444, #b30000); } 
        .normal { background: #444; border: 1px solid var(--gold); }
        .save-btn { font-size: 11px; background: var(--save); color: white; padding: 4px 8px; border-radius: 5px; cursor: pointer; }
        
        .user-info {
            background: #333;
            color: var(--accent);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-bottom: 10px;
            text-align: center;
        }
        .change-name-btn {
            background: #00ccff;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 3px 8px;
            font-size: 10px;
            margin-left: 5px;
            cursor: pointer;
        }
        
        .popup-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .popup-content {
            background: var(--card);
            border: 2px solid var(--gold);
            border-radius: 20px;
            padding: 20px;
            max-width: 400px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
            position: relative;
        }
        .popup-close {
            position: absolute;
            top: 10px; right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: var(--gold);
        }
        .popup-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            color: var(--gold);
        }
        
        .fixed-count {
            font-size: 12px;
            color: var(--accent);
            margin: 5px 0;
            text-align: center;
        }
        .small-note { margin-top: 3px; color: #888; font-size: 9px; text-align: center; }
    </style>
</head>
<body>
<div class="outer-border">
    <div class="header-box">
        <span class="next-episode">SHIN-UI-SON + 1ë²ˆì½”ë“œ</span>
        <div id="roundDisplay" class="round-big">1212íšŒ</div>
    </div>
    
    <div id="userDisplay" class="user-info"></div>
    <div id="status" class="status-info">ë¶„ì„ ì´ˆê¸°í™” ì¤‘...</div>

    <div class="selector-container">
        <button id="toggleBtn" class="selector-toggle" onclick="togglePanel()">âš™ï¸ ë²ˆí˜¸ ì„ íƒê¸°</button>
        <div id="selectorPanel">
            <div class="fixed-count" id="fixedCount">ğŸ”’ ê³ ì •: 0/6</div>
            <div class="selector-grid" id="selectorGrid"></div>
            <button onclick="togglePanel()" style="width:100%; margin-top:10px; height:35px; background:var(--accent); color:#000; border-radius:5px; font-weight:bold;">ë‹«ê¸°</button>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn-main" onclick="process(5)">5ì¡°í•©</button>
        <button class="btn-main" onclick="process(10)">10ì¡°í•©</button>
        <button class="btn-sub" onclick="openPopup()">ë³´ê´€í•¨</button>
        <button class="btn-sub" onclick="clearStorage()">ì´ˆê¸°í™”</button>
        <button class="btn-sub btn-reset" onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <div id="console"></div>
    <div class="small-note">â€» 9,10ë²ˆ ì¡°í•©ì— ë¯¸ì¶œìˆ˜ í¬í•¨ (ìµœëŒ€ 4ê°œ) | ê³ ì • ìµœëŒ€ 6ê°œ</div>
</div>

<div id="popup" class="popup-overlay" style="display:none;">
    <div class="popup-content">
        <span class="popup-close" onclick="closePopup()">&times;</span>
        <div class="popup-title">ğŸ“¦ ë³´ê´€í•¨</div>
        <div id="storage"></div>
    </div>
</div>

<script>
    // ===== 1ë²ˆì½”ë“œì— í•„ìš”í•œ 6ê°œ íšŒì°¨ ë°ì´í„° (1211 + 52ì£¼ ì „ 5ê°œ) =====
    const FULL_DATA = [
        [1211, 23,26,27,35,38,40,10],
        [1160, 7,13,18,36,39,45,19],
        [1108, 7,19,26,37,39,44,27],
        [1056, 13,20,24,32,36,45,29],
        [1004, 7,15,30,37,39,44,18],
        [952,  4,12,22,24,33,41,38]
    ];

    // ===== 1ë²ˆì½”ë“œ ì•Œê³ ë¦¬ì¦˜ (17ìˆ˜ ìƒì„±) =====
    function lottoSystem00001212Final(allData, lastWinning) {
        let dataMap = {};
        allData.forEach(row => dataMap[row[0]] = row);

        const targetRounds = [1160, 1108, 1056, 1004, 952];

        let mainPool = [], bonusPool = [];
        targetRounds.forEach(r => {
            if (dataMap[r]) {
                mainPool.push(...dataMap[r].slice(1, 7));
                bonusPool.push(dataMap[r][7]);
            }
        });

        let survivors = Array.from(new Set([...mainPool, ...bonusPool]));

        let mainFreq = {}, bonusFreq = {};
        mainPool.forEach(n => mainFreq[n] = (mainFreq[n] || 0) + 1);
        bonusPool.forEach(n => bonusFreq[n] = (bonusFreq[n] || 0) + 1);

        let rankedAll = survivors.sort((a, b) => {
            let aInLast = lastWinning.includes(a);
            let bInLast = lastWinning.includes(b);
            if (aInLast && !bInLast) return -1;
            if (!aInLast && bInLast) return 1;
            let aFreq = mainFreq[a] || 0, bFreq = mainFreq[b] || 0;
            if (aFreq > bFreq) return -1;
            if (aFreq < bFreq) return 1;
            return a - b;
        });

        let final17 = rankedAll.slice(0, 13);
        let remaining = rankedAll.slice(13);
        let rebels = remaining.sort((a, b) => {
            let aFreq = bonusFreq[a] || 0, bFreq = bonusFreq[b] || 0;
            if (aFreq > bFreq) return -1;
            if (aFreq < bFreq) return 1;
            return a - b;
        }).slice(0, 4);
        final17.push(...rebels);

        let sections = [[1,10], [11,20], [21,30], [31,40], [41,45]];
        sections.forEach(([start, end]) => {
            if (!final17.some(n => n >= start && n <= end)) {
                let candidates = survivors.filter(n => n >= start && n <= end && !final17.includes(n));
                if (candidates.length) {
                    candidates.sort((a, b) => (bonusFreq[b]||0) - (bonusFreq[a]||0) || a - b);
                    final17.pop();
                    final17.push(candidates[0]);
                }
            }
        });

        return Array.from(new Set(final17)).sort((a, b) => a - b);
    }

    // ===== ì „ì—­ ë³€ìˆ˜ =====
    let basket = [], zeroFreqNums = [], machineFixed = [];
    let dynamicAvgSum = 145;
    
    // ===== ì‚¬ìš©ì ì„¤ì • =====
    let userName = "";
    let savedNumbers = [];
    let fixedNumbers = JSON.parse(localStorage.getItem('fixedNumbersV24')) || [];
    let myPool = [];
    
    // ===== UI í•¨ìˆ˜ =====
    function togglePanel() {
        const panel = document.getElementById('selectorPanel');
        panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
    }
    
    function renderSelector() {
        const grid = document.getElementById('selectorGrid');
        if(!grid) return;
        
        grid.innerHTML = "";
        
        for(let i=1; i<=45; i++) {
            const wrapper = document.createElement('div');
            wrapper.className = 'number-wrapper';
            
            const numDiv = document.createElement('div');
            numDiv.className = `sel-box ${myPool.includes(i) ? 'active' : ''}`;
            numDiv.innerText = i;
            
            numDiv.onclick = () => {
                if(myPool.includes(i)) {
                    myPool = myPool.filter(n => n !== i);
                } else {
                    if(myPool.length < 45) {
                        myPool.push(i);
                    } else {
                        alert("ìµœëŒ€ 45ê°œê¹Œì§€ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                    }
                }
                localStorage.setItem('myPoolV20', JSON.stringify(myPool));
                renderSelector();
            };
            
            const fixBtn = document.createElement('button');
            fixBtn.className = `fix-btn ${fixedNumbers.includes(i) ? 'fixed' : ''}`;
            fixBtn.innerText = fixedNumbers.includes(i) ? 'ğŸ”’' : 'ê³ ì •';
            
            fixBtn.onclick = (e) => {
                e.stopPropagation();
                
                if(fixedNumbers.includes(i)) {
                    fixedNumbers = fixedNumbers.filter(n => n !== i);
                } else {
                    if(fixedNumbers.length < 6) {
                        fixedNumbers.push(i);
                    } else {
                        alert("ê³ ì • ë²ˆí˜¸ëŠ” ìµœëŒ€ 6ê°œê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                        return;
                    }
                }
                
                localStorage.setItem('fixedNumbersV24', JSON.stringify(fixedNumbers));
                document.getElementById('fixedCount').innerHTML = `ğŸ”’ ê³ ì •: ${fixedNumbers.length}/6`;
                renderSelector();
            };
            
            wrapper.appendChild(numDiv);
            wrapper.appendChild(fixBtn);
            grid.appendChild(wrapper);
        }
        
        document.getElementById('fixedCount').innerHTML = `ğŸ”’ ê³ ì •: ${fixedNumbers.length}/6`;
    }
    
    // ===== ë¶„ì„ í•¨ìˆ˜ (1ë²ˆì½”ë“œ ê¸°ë°˜) =====
    function analyze() {
        // ë¯¸ì¶œìˆ˜ ë¶„ì„ (ìµœê·¼ 22íšŒ) - FULL_DATAê°€ 6ê°œë¿ì´ë¯€ë¡œ ëª¨ë“  ë°ì´í„° ì‚¬ìš©
        let freq22 = {};
        for(let i=1; i<=45; i++) freq22[i] = 0;
        FULL_DATA.forEach(row => {
            for(let j=1; j<=7; j++) {
                if(row[j]) freq22[row[j]]++;
            }
        });
        zeroFreqNums = Object.keys(freq22).filter(n => freq22[n] === 0).map(Number).sort((a,b)=>a-b);

        // ê¸°ëŒ€ í•©ê³„ (ê°„ì†Œí™”: 1211íšŒ í•©ê³„)
        const lastSum = FULL_DATA[0].slice(1,7).reduce((a,b)=>a+b,0);
        dynamicAvgSum = lastSum;

        // 1ë²ˆì½”ë“œ ì‹¤í–‰
        const lastWinning = FULL_DATA[0].slice(1, 7);
        basket = lottoSystem00001212Final(FULL_DATA, lastWinning);

        // AI ì¶”ì²œ 17ìˆ˜ë¥¼ ì„ íƒê¸°ì— ë°˜ì˜
        myPool = [...basket];
        localStorage.setItem('myPoolV20', JSON.stringify(myPool));

        machineFixed = basket.slice(0, 3);

        const today = new Date();
        const currentMonth = today.getMonth() + 1;
        const monthNames = ['','1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
        const currentRound = 1212;
        
        document.getElementById('roundDisplay').innerHTML = `${currentRound}íšŒ`;
        document.getElementById('status').innerHTML = `
            <div><span class="highlight-gold">â˜… 1ë²ˆì½”ë“œ í†µí•© ì—”ì§„ [${monthNames[currentMonth]}]</span></div>
            <div><span class="highlight-red">ğŸ¯ ë¯¸ì¶œìˆ˜(ì „ì²´):</span> ${zeroFreqNums.length > 0 ? zeroFreqNums.join(', ') : 'ì—†ìŒ'}</div>
            <div>AI ì¶”ì²œ 17ìˆ˜: ${basket.join(', ')}</div>
            <div><span class="highlight-blue">ğŸ“Š ê¸°ì¤€ í•©ê³„:</span> ${dynamicAvgSum} (${dynamicAvgSum-28}~${dynamicAvgSum+28})</div>
        `;
        
        renderSelector();
    }
    
    // ===== ì¡°í•© ìƒì„± =====
    function process(limit) {
        analyze();
        
        let availableNumbers = [...new Set([...basket, ...fixedNumbers, ...myPool])].sort((a,b)=>a-b);
        
        const box = document.getElementById('console');
        box.innerHTML = "";
        let count = 0, used = new Set(), safety = 0;
        let minSum = dynamicAvgSum - 28;
        let maxSum = dynamicAvgSum + 28;

        while(count < limit && safety < 10000) {
            safety++;
            let res = new Set();
            let currentIdx = count + 1;
            let zeroCount = 0;

            fixedNumbers.forEach(n => res.add(n));

            if (limit === 10 && (currentIdx === 9 || currentIdx === 10) && zeroFreqNums.length > 0) {
                let availableZeros = [...zeroFreqNums].filter(n => !fixedNumbers.includes(n));
                let maxPossible = Math.min(4, availableZeros.length);
                if(maxPossible > 0) {
                    let selectCount = Math.floor(Math.random() * maxPossible) + 1;
                    for(let i = 0; i < selectCount; i++) {
                        if(availableZeros.length === 0) break;
                        let randomIndex = Math.floor(Math.random() * availableZeros.length);
                        res.add(availableZeros[randomIndex]);
                        zeroCount++;
                        availableZeros.splice(randomIndex, 1);
                    }
                }
            }

            let shuffleAvailable = [...availableNumbers].filter(n => !fixedNumbers.includes(n)).sort(() => Math.random() - 0.5);
            for(let n of shuffleAvailable) {
                if(res.size >= 6) break;
                res.add(n);
            }

            while(res.size < 6) {
                let rand = Math.floor(Math.random()*45)+1;
                res.add(rand);
            }

            let finalArr = Array.from(res).sort((a,b)=>a-b);
            let sum = finalArr.reduce((a,b)=>a+b, 0);
            let key = finalArr.join(',');

            if(!used.has(key) && sum >= minSum && sum <= maxSum) {
                used.add(key);
                count++;
                let specialMark = (limit === 10 && (count === 9 || count === 10)) ? 'ğŸ”¥' : '';
                renderRow(finalArr, box, key, specialMark);
            }
        }
    }
    
    function renderRow(arr, target, key, specialMark = '') {
        const html = arr.map(n => {
            if(fixedNumbers.includes(n)) return `<span class="num-box fixed">${n}</span>`;
            if(zeroFreqNums.includes(n)) return `<span class="num-box zero">${n}</span>`;
            return `<span class="num-box normal">${n}</span>`;
        }).join('');
        let specialHtml = specialMark ? `<span class="badge" style="margin-right:5px;">ğŸ”¥</span>` : '';
        target.innerHTML += `<div class="row-line"><div class="num-container">${html}</div><div style="display:flex; align-items:center;">${specialHtml}<div class="save-btn" onclick="saveToBox('${key}')">ì €ì¥</div></div></div>`;
    }
    
    // ===== ì‚¬ìš©ì ê´€ë¦¬ =====
    function updateUserDisplay() {
        const userDisplay = document.getElementById('userDisplay');
        userDisplay.innerHTML = `ğŸ‘¤ ${userName} 
            <button class="change-name-btn" onclick="changeName()">ë³€ê²½</button>
            <button class="change-name-btn" style="background:#ff4444;" onclick="deleteUser()">ì‚­ì œ</button>`;
    }
    
    function changeName() {
        const newName = prompt("ìƒˆ ì´ë¦„:", userName);
        if(newName) {
            userName = newName;
            localStorage.setItem('lottoUserName', userName);
            const storageKey = `lottoSave_${userName}`;
            savedNumbers = JSON.parse(localStorage.getItem(storageKey)) || [];
            updateUserDisplay();
        }
    }
    
    function deleteUser() {
        if(confirm(`ì •ë§ ${userName}ë‹˜ì˜ ê¸°ë¡ì„ ì‚­ì œ?`)) {
            localStorage.removeItem(`lottoSave_${userName}`);
            userName = "guest_" + Math.random().toString(36).substring(2,6);
            localStorage.setItem('lottoUserName', userName);
            savedNumbers = [];
            updateUserDisplay();
        }
    }
    
    function initUser() {
        userName = localStorage.getItem('lottoUserName') || "guest_" + Math.random().toString(36).substring(2,6);
        if(!localStorage.getItem('lottoUserName')) localStorage.setItem('lottoUserName', userName);
        const storageKey = `lottoSave_${userName}`;
        savedNumbers = JSON.parse(localStorage.getItem(storageKey)) || [];
        updateUserDisplay();
    }
    
    function saveToBox(s) {
        if(!savedNumbers.includes(s)) {
            savedNumbers.push(s);
            localStorage.setItem(`lottoSave_${userName}`, JSON.stringify(savedNumbers));
            alert(`ğŸ“¦ ë³´ê´€í•¨ ì €ì¥ ì™„ë£Œ (${savedNumbers.length}ê°œ)`);
        }
    }
    
    function openPopup() {
        document.getElementById('popup').style.display = 'flex';
        renderStorage();
    }

    function closePopup() {
        document.getElementById('popup').style.display = 'none';
    }

    function renderStorage() {
        const st = document.getElementById('storage');
        if(savedNumbers.length === 0) { 
            st.innerHTML = "<div style='text-align:center; padding:20px; opacity:0.5;'>ì €ì¥ëœ ì¡°í•©ì´ ì—†ìŠµë‹ˆë‹¤.</div>"; 
            return; 
        }
        
        st.innerHTML = savedNumbers.map((n, index) => {
            const numbers = n.split(',');
            return `
                <div class="row-line" style="margin-bottom:10px; background:#2a2a2a;">
                    <div class="num-container">
                        ${numbers.map(v=>`<span class="num-box normal" style="background:#444; font-size:12px;">${v}</span>`).join('')}
                    </div>
                    <div style="display:flex; gap:5px;">
                        <button onclick="loadFromStorage('${n}')" 
                                style="background:#00ccff; color:white; border:none; border-radius:5px; padding:5px 8px; font-size:11px; cursor:pointer;">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                        <button onclick="deleteSingleItem(${index})" 
                                style="background:#ff4444; color:white; border:none; border-radius:5px; padding:5px 8px; font-size:11px; cursor:pointer;">ì‚­ì œ</button>
                    </div>
                </div>
            `;
        }).join('');
        
        document.querySelector('.popup-title').innerHTML = `ğŸ“¦ ${userName}ì˜ ë³´ê´€í•¨ (${savedNumbers.length}ê°œ)`;
    }

    function loadFromStorage(nums) {
        alert(`ì„ íƒëœ ë²ˆí˜¸: ${nums.split(',').join(', ')}`);
        closePopup();
    }

    function deleteSingleItem(index) {
        if(confirm("ì´ ì¡°í•©ì„ ì‚­ì œí• ê¹Œìš”?")) {
            savedNumbers.splice(index, 1);
            const storageKey = `lottoSave_${userName}`;
            localStorage.setItem(storageKey, JSON.stringify(savedNumbers));
            renderStorage();
        }
    }
    
    function clearStorage() {
        if(confirm("ë³´ê´€í•¨ì„ ì´ˆê¸°í™”í• ê¹Œìš”?")) {
            savedNumbers = [];
            const storageKey = `lottoSave_${userName}`;
            localStorage.removeItem(storageKey);
            renderStorage();
        }
    }
    
    window.onload = function() {
        initUser();
        analyze();
    };
</script>
</body>
</html>
