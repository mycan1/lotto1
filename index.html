    async function initEngine() {
        const logs = document.getElementById('logs');
        try {
            const response = await fetch('./lotto.txt');
            const text = await response.text();
            // íŒŒì´ì¬ì˜ sep=r'[,\.]' ë¡œì§ ë°˜ì˜
            const rows = text.trim().split(/\r?\n/).map(row => {
                const numbers = row.match(/\d+/g);
                return numbers ? numbers.map(Number) : [];
            }).filter(r => r.length >= 7);

            const lastRound = rows[0][0];
            analysisData.nextRound = lastRound + 1;

            // 1. ìµœê·¼ 30íšŒ ë¯¸ì¶œìˆ˜ (ë‹¹ì²¨ë²ˆí˜¸ + ë³´ë„ˆìŠ¤ ì „ì²´ ì œì™¸)
            const recent30 = rows.slice(0, 30);
            const appeared = new Set();
            recent30.forEach(r => { 
                r.slice(1, 8).forEach(n => appeared.add(n)); 
            });
            analysisData.missing = Array.from({length: 45}, (_, i) => i + 1).filter(n => !appeared.has(n));

            // 2. ë‹¹ì²¨ ë¹ˆì¶œìˆ˜ (ìµœê·¼ 35íšŒ Base12)
            const recent_35 = rows.slice(0, 35);
            const flat_win = recent_35.flatMap(r => r.slice(1, 7));
            const win_counts = {};
            flat_win.forEach(n => win_counts[n] = (win_counts[n] || 0) + 1);
            analysisData.base12 = Object.entries(win_counts)
                .sort((a,b) => b[1] - a[1]).slice(0, 12).map(v => Number(v[0]));

            // 3. íŒŒì´ì¬ ë³´ë„ˆìŠ¤ ë¶„ì„ ë¡œì§ (eligible ì¶”ì¶œ)
            const bn_list = recent_35.map(r => r[7]).filter(n => n !== undefined);
            const bn_counts = {};
            bn_list.forEach(n => bn_counts[n] = (bn_counts[n] || 0) + 1);
            
            // íŒŒì´ì¬ ì¡°ê±´: c*0.5 > 1.5 (ì¦‰, 3íšŒ ì´ˆê³¼ ì¶œí˜„í•œ ë³´ë„ˆìŠ¤ ë²ˆí˜¸)
            let eligible = Object.entries(bn_counts)
                .filter(([n, c]) => c > 3) 
                .sort((a,b) => b[1] - a[1]) // ë¹ˆë„ìˆœ ì •ë ¬
                .map(v => Number(v[0]));

            // bn5, bn6, bn7 í• ë‹¹ (íŒŒì´ì¬ if len(eligible) ë¡œì§)
            analysisData.bn5 = eligible[0] || null;
            analysisData.bn6 = eligible[1] || eligible[0] || null;
            analysisData.bn7 = eligible[2] || eligible[0] || null;

            // 4. ë¶„ì„ í’€ (Base12 + Eligible Top 3 + Missing)
            analysisData.pool = Array.from(new Set([...analysisData.base12, ...eligible.slice(0, 3), ...analysisData.missing])).sort((a,b)=>a-b);

            document.getElementById('header-info').innerText = `ğŸ¯ ì œ ${analysisData.nextRound}íšŒì°¨ ì›ë³¸ë¡œì§ ë™ê¸°í™”`;
            document.getElementById('genBtn').disabled = false;
            
            logs.innerHTML = `
                <div class="log-entry" style="color:#00ff00">â–¶ íŒŒì´ì¬ ë³´ë„ˆìŠ¤ ë¶„ì„(eligible) ì™„ë£Œ</div>
                <div class="log-entry">ë³´ë„ˆìŠ¤ íƒ€ê²Ÿ: [${eligible.slice(0, 3).join(', ')}]</div>
                <div class="log-entry">ë¯¸ì¶œìˆ˜: [${analysisData.missing.join(', ')}]</div>
            `;
        } catch (e) { logs.innerHTML = "ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜"; }
    }

    function generateEngine() {
        const logs = document.getElementById('logs');
        const { pool, missing, base12, bn5, bn6, bn7 } = analysisData;
        const core_nums = base12.slice(0, 5);
        let results = [];
        let attempts = 0;

        while(results.length < 10 && attempts < 50000) {
            attempts++;
            let comb = [...pool].sort(() => Math.random() - 0.5).slice(0, 6).sort((a,b)=>a-b);
            
            // íŒŒì´ì¬ ê³µí†µ í•„í„°
            const sum = comb.reduce((a,b)=>a+b, 0);
            if(sum < 100 || sum > 170) continue; // íŒŒì´ì¬ ê¸°ì¤€ 170
            
            const ac = getAC(comb);
            const odds = comb.filter(n => n % 2 !== 0).length;
            if(odds === 0 || odds === 6) continue;
            
            // ì—°ì†ë²ˆí˜¸ ì œí•œ (3ê°œ ê¸ˆì§€)
            let consecutive = 0, maxCons = 1;
            for(let i=0; i<5; i++) {
                if(comb[i]+1 === comb[i+1]) { consecutive++; maxCons = Math.max(maxCons, consecutive+1); }
                else consecutive = 0;
            }
            if(maxCons >= 3) continue;

            const missing_count = comb.filter(n => missing.includes(n)).length;
            const core_match = comb.filter(n => core_nums.includes(n)).length;
            const idx = results.length + 1;
            let pass = false;

            // --- íŒŒì´ì¬ generate_fixed_combinations ë¡œì§ ì ìš© ---
            if (idx <= 7) { // 1~7ë²ˆ ì•ˆì •í˜•
                if (missing_count === 0 && ac >= 7 && ac <= 10) {
                    if (idx === 5 && bn5) pass = comb.includes(bn5);
                    else if (idx === 6 && bn6) pass = comb.includes(bn6);
                    else if (idx === 7 && bn7) pass = comb.includes(bn7);
                    else if (idx <= 2) pass = (core_match >= 2);
                    else pass = true;
                }
            } else { // 8~10ë²ˆ ì „ëµí˜•
                if (idx === 8) { // ë³´ë„ˆìŠ¤ 1ìœ„ + ë¯¸ì¶œìˆ˜ 1ê°œ
                    if (bn5 && comb.includes(bn5) && missing_count === 1 && ac >= 7) pass = true;
                } else if (idx === 9) { // ë¯¸ì¶œìˆ˜ 2ê°œ
                    if (missing_count === 2 && ac >= 7) pass = true;
                } else if (idx === 10) { // í•µì‹¬ìˆ˜ 3ê°œ + ë¯¸ì¶œìˆ˜ 1ê°œ ì´ìƒ
                    if (ac >= 8 && core_match >= 3 && missing_count >= 1) pass = true;
                }
            }

            if(pass) {
                results.push(comb);
                const type = idx <= 7 ? "ì•ˆì •í˜•" : "ì „ëµí˜•";
                const balls = comb.map(n => `<span class="ball">${n}</span>`).join('');
                logs.innerHTML += `<div class="log-entry"><span class="tag">${type}</span> #${idx}<br>${balls}</div>`;
                logs.scrollTop = logs.scrollHeight;
            }
        }
    }
