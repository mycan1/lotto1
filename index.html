<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì‹ ì˜ì† - 1213íšŒ (ìµœì†Œë°ì´í„°)</title>
    <style>
        :root { --gold: #ffd700; --bg: #0b0b0b; --card: #1a1a1a; --accent: #00ffcc; --save: #ff00ff; }
        body { background-color: var(--bg); color: var(--gold); font-family: 'Malgun Gothic', sans-serif; padding: 10px; margin: 0; }
        .outer-border { border: 2px solid var(--gold); border-radius: 20px; padding: 15px; max-width: 480px; margin: 0 auto; }
        .header-box { text-align: center; margin-bottom: 10px; }
        .next-episode { font-size: 24px; font-weight: 900; color: #fff; text-shadow: 0 0 10px rgba(255,215,0,0.5); }
        .round-big { font-size: 48px; font-weight: 900; color: #ffd700; text-shadow: 0 0 20px #ffd700; margin: 5px 0; }
        .status-info { font-size: 11px; color: var(--accent); background: rgba(255,255,255,0.05); border-radius: 12px; padding: 10px; margin: 10px 0; border: 1px solid #333; }
        .highlight-gold { color: var(--gold); font-weight: bold; }
        .highlight-blue { color: #00ccff; font-weight: bold; }
        
        /* ì„ íƒê¸° ì˜ì—­ (ë™ì¼) */
        .selector-container { margin-bottom: 15px; }
        .selector-toggle { width: 100%; height: 40px; background: #222; border: 1px solid var(--gold); border-radius: 10px; color: var(--gold); font-weight: bold; cursor: pointer; }
        #selectorPanel { display: none; background: #1a1a1a; border-radius: 10px; padding: 10px; border: 1px solid #333; }
        .selector-grid { display: grid; grid-template-columns: repeat(9, 1fr); gap: 8px; }
        .number-wrapper { display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .sel-box { aspect-ratio: 1; width: 100%; display: flex; align-items: center; justify-content: center; background: #333; color: #888; cursor: pointer; border-radius: 4px; }
        .sel-box.active { background: var(--accent); color: #000; font-weight: bold; }
        .fix-btn { width: 100%; font-size: 10px; padding: 4px 0; border: none; border-radius: 3px; background: #333; color: #aaa; cursor: pointer; }
        .fix-btn.fixed { background: #ff00ff; color: white; font-weight: bold; }
        
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 15px 0; }
        button { border-radius: 10px; font-weight: bold; cursor: pointer; border: none; height: 45px; }
        .btn-main { background: linear-gradient(135deg, #ffd700, #b8860b); color: #000; }
        .btn-sub { background: #222; color: #fff; border: 1px solid #444; }
        .btn-reset { grid-column: span 2; background: #333; color: #aaa; }
        
        .row-line { background: var(--card); border-radius: 12px; padding: 10px; margin-bottom: 8px; display: flex; align-items: center; border: 1px solid #333; }
        .num-container { display: flex; gap: 4px; flex-grow: 1; justify-content: center; flex-wrap: wrap; }
        .num-box { width: 32px; height: 32px; line-height: 32px; text-align: center; border-radius: 50%; font-weight: 900; color: #fff; }
        .fixed { background: linear-gradient(135deg, #00ffcc, #00a884); color: #000; } 
        .normal { background: #444; border: 1px solid var(--gold); }
        .save-btn { font-size: 11px; background: var(--save); color: white; padding: 4px 8px; border-radius: 5px; cursor: pointer; }
        
        .user-info { background: #333; color: var(--accent); padding: 5px; border-radius: 20px; font-size: 12px; margin-bottom: 10px; text-align: center; }
        .change-name-btn { background: #00ccff; color: white; border: none; border-radius: 5px; padding: 3px 8px; font-size: 10px; margin-left: 5px; cursor: pointer; }
        
        .popup-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index:1000; }
        .popup-content { background: var(--card); border: 2px solid var(--gold); border-radius: 20px; padding: 20px; max-width:400px; width:90%; max-height:70vh; overflow-y: auto; position: relative; }
        .popup-close { position: absolute; top:10px; right:15px; font-size:24px; cursor: pointer; color: var(--gold); }
        .popup-title { font-size:18px; font-weight: bold; margin-bottom:15px; text-align: center; color: var(--gold); }
        .fixed-count { font-size:12px; color: var(--accent); margin:5px 0; text-align: center; }
        .small-note { margin-top:3px; color:#888; font-size:9px; text-align: center; }
        *:focus, *:active { outline: none; -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body>
<div class="outer-border">
    <div class="header-box">
        <span class="next-episode">SHIN-UI-SON (ë²ˆí˜¸ì„ íƒê°€ëŠ¥)</span>
        <div id="roundDisplay" class="round-big">1213íšŒ</div>
    </div>
    <div id="userDisplay" class="user-info"></div>
    <div id="status" class="status-info">ë¶„ì„ ì´ˆê¸°í™” ì¤‘...</div>

    <div class="selector-container">
        <button class="selector-toggle" onclick="togglePanel()">âš™ï¸ ë²ˆí˜¸ ì„ íƒê¸°</button>
        <div id="selectorPanel">
            <div class="fixed-count" id="fixedCount">ğŸ”’ ê³ ì •: 0/6</div>
            <div class="selector-grid" id="selectorGrid"></div>
            <button onclick="togglePanel()" style="width:100%; margin-top:10px; height:35px; background:var(--accent); color:#000; border-radius:5px;">ë‹«ê¸°</button>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn-main" onclick="process(5)">5ì¡°í•©</button>
        <button class="btn-main" onclick="process(10)">10ì¡°í•©</button>
        <button class="btn-sub" onclick="openPopup()">ë³´ê´€í•¨</button>
        <button class="btn-sub" onclick="clearStorage()">ì´ˆê¸°í™”</button>
        <button class="btn-sub btn-reset" onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <div id="console"></div>
    <div class="small-note">â€» 9,10ë²ˆ ì¡°í•©ì— ë¯¸ì¶œìˆ˜ í¬í•¨ (ìµœëŒ€ 4ê°œ) | ê³ ì • ìµœëŒ€ 6ê°œ</div>
</div>

<div id="popup" class="popup-overlay" style="display:none;">
    <div class="popup-content">
        <span class="popup-close" onclick="closePopup()">&times;</span>
        <div class="popup-title">ğŸ“¦ ë³´ê´€í•¨</div>
        <div id="storage"></div>
    </div>
</div>

<script>
    // ===== ìµœì†Œ ë°ì´í„°: 1212íšŒ + 1213 ê¸°ì¤€ 52ì£¼ ì „ 5ê°œ íšŒì°¨ =====
    const FULL_DATA = [
        [1212, 5,8,25,31,41,44,45],   // ì´ì›”ìˆ˜ ê³„ì‚°ìš©
        [1161, 2,12,20,24,34,42,37],
        [1109, 10,12,13,19,33,40,2],
        [1057, 8,13,19,27,40,45,12],
        [1005, 8,13,18,24,27,29,17],
        [953,  7,9,22,27,37,42,34]
    ];

    // ===== 1ë²ˆì½”ë“œ ì•Œê³ ë¦¬ì¦˜ (1213íšŒ ê¸°ì¤€) =====
    function lottoSystem00001212Final(allData, lastWinning) {
        const targetRounds = [1161, 1109, 1057, 1005, 953];
        let dataMap = {};
        allData.forEach(row => dataMap[row[0]] = row);

        let mainPool = [], bonusPool = [];
        targetRounds.forEach(r => {
            if (dataMap[r]) {
                mainPool.push(...dataMap[r].slice(1, 7));
                bonusPool.push(dataMap[r][7]);
            }
        });

        let survivors = [...new Set([...mainPool, ...bonusPool])];

        let mainFreq = {}, bonusFreq = {};
        mainPool.forEach(n => mainFreq[n] = (mainFreq[n]||0)+1);
        bonusPool.forEach(n => bonusFreq[n] = (bonusFreq[n]||0)+1);

        let ranked = survivors.sort((a,b) => {
            let aLast = lastWinning.includes(a), bLast = lastWinning.includes(b);
            if(aLast && !bLast) return -1;
            if(!aLast && bLast) return 1;
            let aFreq = mainFreq[a]||0, bFreq = mainFreq[b]||0;
            if(aFreq > bFreq) return -1;
            if(aFreq < bFreq) return 1;
            return a - b;
        });

        let final17 = ranked.slice(0,13);
        let rebels = ranked.slice(13).sort((a,b) => (bonusFreq[b]||0)-(bonusFreq[a]||0) || a-b).slice(0,4);
        final17.push(...rebels);

        // êµ¬ê°„ ë©”ìš°ê¸°
        let sections = [[1,10],[11,20],[21,30],[31,40],[41,45]];
        sections.forEach(([s,e]) => {
            if(!final17.some(n => n>=s && n<=e)) {
                let cand = survivors.filter(n => n>=s && n<=e && !final17.includes(n));
                if(cand.length) {
                    cand.sort((a,b) => (bonusFreq[b]||0)-(bonusFreq[a]||0) || a-b);
                    final17.pop();
                    final17.push(cand[0]);
                }
            }
        });
        return [...new Set(final17)].sort((a,b)=>a-b);
    }

    // ===== ì „ì—­ ë³€ìˆ˜ =====
    let basket = [], machineFixed = [];
    let dynamicAvgSum = 145;
    let userName = "", savedNumbers = [];
    let fixedNumbers = JSON.parse(localStorage.getItem('fixedNumbersV24')) || [];
    let myPool = [];

    // ===== ë¶„ì„ =====
    function analyze() {
        // ê¸°ì¤€ í•©ê³„: 5ê°œ íšŒì°¨ í‰ê· 
        const targetRounds = [1161,1109,1057,1005,953];
        let sums = [];
        targetRounds.forEach(r => {
            let row = FULL_DATA.find(x => x[0]===r);
            if(row) sums.push(row.slice(1,7).reduce((a,b)=>a+b,0));
        });
        dynamicAvgSum = sums.length ? Math.round(sums.reduce((a,b)=>a+b,0)/sums.length) : 145;

        const lastWinning = FULL_DATA[0].slice(1,7); // 1212íšŒ
        basket = lottoSystem00001212Final(FULL_DATA, lastWinning);
        machineFixed = basket.slice(0,3);
        myPool = [...basket];
        localStorage.setItem('myPoolV20', JSON.stringify(myPool));

        document.getElementById('roundDisplay').innerHTML = `1213íšŒ`;
        document.getElementById('status').innerHTML = `
            <div><span class="highlight-gold">â˜… 1ë²ˆì½”ë“œ (1213íšŒ ê¸°ì¤€)</span></div>
            <div>AI ì¶”ì²œ 17ìˆ˜: ${basket.join(', ')}</div>
            <div><span class="highlight-blue">ğŸ“Š ê¸°ì¤€ í•©ê³„ (5íšŒì°¨ í‰ê· ):</span> ${dynamicAvgSum} (${dynamicAvgSum-25}~${dynamicAvgSum+25})</div>
        `;
        renderSelector();
    }

    // ===== ì„ íƒê¸° ë Œë”ë§ (ìƒëµì—†ì´ í¬í•¨) =====
    function renderSelector() {
        const grid = document.getElementById('selectorGrid');
        if(!grid) return;
        grid.innerHTML = "";
        for(let i=1; i<=45; i++) {
            const w = document.createElement('div'); w.className = 'number-wrapper';
            const n = document.createElement('div');
            n.className = `sel-box ${myPool.includes(i)?'active':''}`;
            n.innerText = i;
            n.onclick = () => {
                if(myPool.includes(i)) myPool = myPool.filter(v=>v!==i);
                else if(myPool.length<45) myPool.push(i);
                localStorage.setItem('myPoolV20', JSON.stringify(myPool));
                renderSelector();
            };
            const f = document.createElement('button');
            f.className = `fix-btn ${fixedNumbers.includes(i)?'fixed':''}`;
            f.innerText = fixedNumbers.includes(i)?'ğŸ”’':'ê³ ì •';
            f.onclick = (e) => {
                e.stopPropagation();
                if(fixedNumbers.includes(i)) fixedNumbers = fixedNumbers.filter(v=>v!==i);
                else if(fixedNumbers.length<6) fixedNumbers.push(i);
                else { alert("ê³ ì • ë²ˆí˜¸ëŠ” ìµœëŒ€ 6ê°œ"); return; }
                localStorage.setItem('fixedNumbersV24', JSON.stringify(fixedNumbers));
                document.getElementById('fixedCount').innerHTML = `ğŸ”’ ê³ ì •: ${fixedNumbers.length}/6`;
                renderSelector();
            };
            w.appendChild(n); w.appendChild(f); grid.appendChild(w);
        }
        document.getElementById('fixedCount').innerHTML = `ğŸ”’ ê³ ì •: ${fixedNumbers.length}/6`;
    }

    function togglePanel() {
        const p = document.getElementById('selectorPanel');
        p.style.display = p.style.display==='block'?'none':'block';
    }

    // ===== ì¡°í•© ìƒì„± =====
    function process(limit) {
        analyze();
        const box = document.getElementById('console');
        box.innerHTML = "";
        let cnt = 0, used = new Set(), safety = 0;
        let minS = dynamicAvgSum - 25, maxS = dynamicAvgSum + 25;

        while(cnt < limit && safety++ < 10000) {
            let res = new Set(fixedNumbers);
            let shuffle = [...new Set([...basket,...fixedNumbers,...myPool])].filter(n=>!fixedNumbers.includes(n));
            shuffle.sort(()=>Math.random()-0.5);
            for(let n of shuffle) { if(res.size>=6) break; res.add(n); }
            while(res.size<6) res.add(Math.floor(Math.random()*45)+1);
            let arr = [...res].sort((a,b)=>a-b);
            let sum = arr.reduce((a,b)=>a+b,0);
            let key = arr.join(',');
            if(!used.has(key) && sum>=minS && sum<=maxS) {
                used.add(key); cnt++;
                let mark = (limit===10 && (cnt===9||cnt===10))?'ğŸ”¥':'';
                renderRow(arr, box, key, mark);
            }
        }
    }

    function renderRow(arr, target, key, mark) {
        let html = arr.map(n => {
            if(fixedNumbers.includes(n)) return `<span class="num-box fixed">${n}</span>`;
            return `<span class="num-box normal">${n}</span>`;
        }).join('');
        target.innerHTML += `<div class="row-line"><div class="num-container">${html}</div><div style="display:flex;">${mark?`<span class="badge" style="margin-right:5px;">ğŸ”¥</span>`:''}<div class="save-btn" onclick="saveToBox('${key}')">ì €ì¥</div></div></div>`;
    }

    // ===== ì‚¬ìš©ì/ë³´ê´€í•¨ í•¨ìˆ˜ (ìƒëµì—†ì´ í¬í•¨) =====
    function updateUserDisplay() {
        document.getElementById('userDisplay').innerHTML = `ğŸ‘¤ ${userName} <button class="change-name-btn" onclick="changeName()">ë³€ê²½</button><button class="change-name-btn" style="background:#ff4444;" onclick="deleteUser()">ì‚­ì œ</button>`;
    }
    function changeName() {
        let n = prompt("ìƒˆ ì´ë¦„:", userName);
        if(n) { userName = n; localStorage.setItem('lottoUserName', n);
            savedNumbers = JSON.parse(localStorage.getItem(`lottoSave_${n}`))||[];
            updateUserDisplay();
        }
    }
    function deleteUser() {
        if(confirm("ì‚­ì œ?")) {
            localStorage.removeItem(`lottoSave_${userName}`);
            userName = "guest_"+Math.random().toString(36).substring(2,6);
            localStorage.setItem('lottoUserName', userName);
            savedNumbers = [];
            updateUserDisplay();
        }
    }
    function initUser() {
        userName = localStorage.getItem('lottoUserName') || "guest_"+Math.random().toString(36).substring(2,6);
        if(!localStorage.getItem('lottoUserName')) localStorage.setItem('lottoUserName', userName);
        savedNumbers = JSON.parse(localStorage.getItem(`lottoSave_${userName}`))||[];
        updateUserDisplay();
    }
    function saveToBox(s) {
        if(!savedNumbers.includes(s)) {
            savedNumbers.push(s);
            localStorage.setItem(`lottoSave_${userName}`, JSON.stringify(savedNumbers));
            alert(`ì €ì¥ë¨ (${savedNumbers.length}ê°œ)`);
        }
    }
    function openPopup() {
        document.getElementById('popup').style.display = 'flex';
        renderStorage();
    }
    function closePopup() {
        document.getElementById('popup').style.display = 'none';
    }
    function renderStorage() {
        let st = document.getElementById('storage');
        if(!savedNumbers.length) { st.innerHTML = "<div style='text-align:center; padding:20px; opacity:0.5;'>ì—†ìŒ</div>"; return; }
        st.innerHTML = savedNumbers.map((n,i)=> {
            let nums = n.split(',');
            return `<div class="row-line"><div class="num-container">${nums.map(v=>`<span class="num-box normal" style="background:#444;">${v}</span>`).join('')}</div><div><button onclick="loadFromStorage('${n}')" style="background:#00ccff;">ë¶ˆëŸ¬ì˜¤ê¸°</button><button onclick="deleteSingleItem(${i})" style="background:#ff4444;">ì‚­ì œ</button></div></div>`;
        }).join('');
        document.querySelector('.popup-title').innerHTML = `ğŸ“¦ ${userName}ì˜ ë³´ê´€í•¨ (${savedNumbers.length}ê°œ)`;
    }
    function loadFromStorage(nums) {
        alert(nums.split(',').join(', ')); closePopup();
    }
    function deleteSingleItem(i) {
        if(confirm("ì‚­ì œ?")) { savedNumbers.splice(i,1);
            localStorage.setItem(`lottoSave_${userName}`, JSON.stringify(savedNumbers));
            renderStorage();
        }
    }
    function clearStorage() {
        if(confirm("ì´ˆê¸°í™”?")) { savedNumbers = [];
            localStorage.removeItem(`lottoSave_${userName}`);
            renderStorage();
        }
    }

    window.onload = function() { initUser(); analyze(); };
</script>
</body>
</html>
